function [best_attribute, maxGain] = ChooseBestDecisionAttribute(examples, attributes, binary_targets)
    % definition of the entropy
    function [entropy] = I(p, n)
        frac = p/(n+p);
        entropy = -frac*log2(frac) - (1-frac)*log2(1-frac);
    end

    values = unique(binary_targets);
    
    % These cases should not arise
    if length(values)==1 % All the examples are the same
        error('If all the examples are the same, should be a leaf');
    else if length(values)>2 % more than two classes (targets)
        error('The target must be binary');
        end
    end
    
    vNo = values(1);  % 0
    vYes = values(2);  % 1
    p = length(binary_targets(binary_targets==vNo)); % count of zeros in binary targets
    n = length(binary_targets(binary_targets==vYes)); % count of ones in binary targets
    global_entropy = I(p, n);
    maxGain = -1; % as gain is > 0, will be overwritten at first iteration

    for i=1:length(attributes)
        p0 = sum(binary_targets(examples(:, i)==0)==vNo);
        n0 = sum(binary_targets(examples(:, i)==0)==vYes);
        p1 = sum(binary_targets(examples(:, i)==1)==vNo);
        n1 = sum(binary_targets(examples(:, i)==1)==vYes);
        s = p + n
        remainder = (p0 + n0)/s*I(p0, n0) + (p1 + n1)/s*I(p1, n1);
        gain = global_entropy - remainder;
        
        if gain > maxGain
            best_attribute = i;
            maxGain = gain;
        end
    end
end